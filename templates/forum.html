{% extends "base.html" %}
{% block title %}Forum | StageFinder{% endblock %}

{% block content %}
<h2>Forum</h2>

<div class="card">
    <h3>Nouveau post</h3>
    <form method="POST">
        <div class="form-group">
            <textarea name="content" placeholder="Exprimez-vous, {{ user.firstname }}..." required></textarea>
        </div>
        <button type="submit" class="btn">Publier</button>
    </form>
</div>

<h3>Fil d'actualit√©</h3>
{% for post in posts %}
    <div class="card">
        <strong>{{ post.author.firstname }} {{ post.author.lastname }}</strong>
        <span style="color: #666; font-size: 0.9em;">@ {{ post.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
        <p>{{ post.content }}</p>

        <!-- LIKE SECTION -->
        <form action="{{ url_for('main.like_post', post_id=post.id) }}" method="POST" style="display:inline;">
            <button type="submit" style="border:none; background:none; cursor:pointer;">
                {% if user in post.liked_by %}
                    ‚ù§Ô∏è
                {% else %}
                    ü§ç
                {% endif %}
            </button>
            <span>{{ post.liked_by.count() }}</span>
        </form>

        <!-- COMMENTS SECTION -->
        <details style="margin-top:10px;">
            <summary>üí¨ Commentaires ({{ post.comments.count() }})</summary>

            <!-- List existing comments -->
            {% for comment in post.comments.all()|reverse %}

                <div style="margin-left: 20px; margin-top: 5px;">
                    <strong>{{ comment.author.firstname }}</strong>:
                    {{ comment.content }}
                    <br>
                    <small style="color:gray;">{{ comment.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
                </div>
            {% else %}
                <p style="margin-left: 20px; color: gray;">Aucun commentaire pour ce post.</p>
            {% endfor %}

            <!-- Add new comment -->
            <form action="{{ url_for('main.comment_post', post_id=post.id) }}" method="POST" style="margin-left: 20px; margin-top: 10px;">
                <input type="text" name="comment" placeholder="Votre commentaire..." required>
                <button type="submit">üí¨ Publier</button>
            </form>
        </details>
    </div>
{% else %}
    <p>Le forum est vide. Soyez le premier √† publier !</p>
{% endfor %}
{% endblock %}
